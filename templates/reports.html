<!-- reports.html -->
{% extends "base.html" %}

{% block title %}Reports & Analytics - Training Center CRM{% endblock %}

{% block breadcrumb %}
{{ super() }}
<li class="breadcrumb-item active">Reports</li>
{% endblock %}

{% block content %}
<!-- Reports Header -->
<div class="row mb-4">
    <div class="col-md-6">
        <h2 class="mb-0">Reports & Analytics</h2>
        <p class="text-muted">Comprehensive insights into your training business performance</p>
    </div>
    <div class="col-md-6 text-end">
        <div class="btn-group me-3" role="group">
            <button type="button" class="btn btn-outline-secondary" onclick="exportReport('pdf')">
                <i class="fas fa-file-pdf me-2"></i>Export PDF
            </button>
            <button type="button" class="btn btn-outline-secondary" onclick="exportReport('excel')">
                <i class="fas fa-file-excel me-2"></i>Export Excel
            </button>
        </div>
        <div class="dropdown d-inline">
            <button class="btn btn-primary-custom dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-calendar me-2"></i>Date Range
            </button>
            <div class="dropdown-menu dropdown-menu-end p-3" style="width: 300px;">
                <h6 class="dropdown-header">Select Date Range</h6>
                <div class="mb-3">
                    <label class="form-label">From Date</label>
                    <input type="date" class="form-control" id="dateFrom" value="{{ date_from }}">
                </div>
                <div class="mb-3">
                    <label class="form-label">To Date</label>
                    <input type="date" class="form-control" id="dateTo" value="{{ date_to }}">
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setQuickRange('week')">Last Week</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setQuickRange('month')">Last Month</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setQuickRange('quarter')">Last Quarter</button>
                </div>
                <button type="button" class="btn btn-primary btn-sm w-100 mt-3" onclick="applyDateFilter()">Apply Filter</button>
            </div>
        </div>
    </div>
</div>

<!-- Key Metrics Dashboard -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="dashboard-card leads">
            <div class="stat-card">
                <div class="card-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number">{{ monthly_leads | length if monthly_leads else 0 }}</div>
                <div class="stat-label">New Leads</div>
                <div class="stat-change text-success">
                    <i class="fas fa-arrow-up"></i> +15% vs last month
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="dashboard-card students">
            <div class="stat-card">
                <div class="card-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="stat-number">{{ conversion_by_source | sum(attribute=1) if conversion_by_source else 0 }}</div>
                <div class="stat-label">Conversions</div>
                <div class="stat-change text-success">
                    <i class="fas fa-arrow-up"></i> +8% vs last month
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="dashboard-card revenue">
            <div class="stat-card">
                <div class="card-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-number">$85,420</div>
                <div class="stat-label">Revenue</div>
                <div class="stat-change text-success">
                    <i class="fas fa-arrow-up"></i> +23% vs last month
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="dashboard-card courses">
            <div class="stat-card">
                <div class="card-icon">
                    <i class="fas fa-percent"></i>
                </div>
                <div class="stat-number">68%</div>
                <div class="stat-label">Conversion Rate</div>
                <div class="stat-change text-warning">
                    <i class="fas fa-arrow-down"></i> -2% vs last month
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row 1 -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="chart-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Monthly Lead Generation & Conversion</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-primary active" onclick="changeChartPeriod('month')">Monthly</button>
                    <button type="button" class="btn btn-outline-primary" onclick="changeChartPeriod('week')">Weekly</button>
                    <button type="button" class="btn btn-outline-primary" onclick="changeChartPeriod('day')">Daily</button>
                </div>
            </div>
            <canvas id="monthlyLeadsChart" height="300"></canvas>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="chart-container">
            <h5 class="mb-3">Lead Sources Performance</h5>
            <canvas id="sourcePerformanceChart" height="300"></canvas>
        </div>
    </div>
</div>

<!-- Charts Row 2 -->
<div class="row mb-4">
    <div class="col-lg-6">
        <div class="chart-container">
            <h5 class="mb-3">Revenue Breakdown by Category</h5>
            <canvas id="revenueBreakdownChart" height="250"></canvas>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="chart-container">
            <h5 class="mb-3">Course Popularity & Enrollment</h5>
            <canvas id="coursePopularityChart" height="250"></canvas>
        </div>
    </div>
</div>

<!-- Detailed Reports Section -->
<div class="row">
    <div class="col-lg-8">
        <!-- Sales Performance Report -->
        <div class="dashboard-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Sales Performance Report</h5>
                <button class="btn btn-sm btn-outline-primary" onclick="expandReport('sales')">
                    <i class="fas fa-expand-alt me-1"></i>View Details
                </button>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>This Month</th>
                            <th>Last Month</th>
                            <th>Change</th>
                            <th>Target</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Total Leads</strong></td>
                            <td>{{ monthly_leads | length if monthly_leads else 0 }}</td>
                            <td>{{ (monthly_leads | length - 5) if monthly_leads else 0 }}</td>
                            <td><span class="text-success"><i class="fas fa-arrow-up"></i> +15%</span></td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td><strong>Qualified Leads</strong></td>
                            <td>185</td>
                            <td>165</td>
                            <td><span class="text-success"><i class="fas fa-arrow-up"></i> +12%</span></td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td><strong>Conversions</strong></td>
                            <td>{{ conversion_by_source | sum(attribute=1) if conversion_by_source else 0 }}</td>
                            <td>{{ (conversion_by_source | sum(attribute=1) - 8) if conversion_by_source else 0 }}</td>
                            <td><span class="text-success"><i class="fas fa-arrow-up"></i> +8%</span></td>
                            <td>75</td>
                        </tr>
                        <tr>
                            <td><strong>Average Deal Size</strong></td>
                            <td>$1,250</td>
                            <td>$1,180</td>
                            <td><span class="text-success"><i class="fas fa-arrow-up"></i> +6%</span></td>
                            <td>$1,300</td>
                        </tr>
                        <tr>
                            <td><strong>Revenue</strong></td>
                            <td>$85,420</td>
                            <td>$69,800</td>
                            <td><span class="text-success"><i class="fas fa-arrow-up"></i> +23%</span></td>
                            <td>$90,000</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Course Performance Report -->
        <div class="dashboard-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Course Performance Analysis</h5>
                <button class="btn btn-sm btn-outline-primary" onclick="expandReport('courses')">
                    <i class="fas fa-expand-alt me-1"></i>View Details
                </button>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Course</th>
                            <th>Enrollments</th>
                            <th>Revenue</th>
                            <th>Completion Rate</th>
                            <th>Satisfaction</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for course, enrollments in course_popularity %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="course-icon bg-primary text-white rounded me-2 d-flex align-items-center justify-content-center" 
                                         style="width: 30px; height: 30px; font-size: 12px;">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <strong>{{ course }}</strong>
                                </div>
                            </td>
                            <td>{{ enrollments }}</td>
                            <td>${{ (enrollments * 1200) | round | int }}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">{{ (85 + loop.index * 2) }}%</span>
                                    <div class="progress-custom" style="width: 60px;">
                                        <div class="progress-bar-custom" style="width: {{ (85 + loop.index * 2) }}%"></div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">{{ (4.2 + loop.index * 0.1) | round(1) }}/5</span>
                                    <div class="rating-stars">
                                        {% for i in range(5) %}
                                        <i class="fas fa-star {{ 'text-warning' if i < (4.2 + loop.index * 0.1) else 'text-muted' }}"></i>
                                        {% endfor %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="text-success">
                                    <i class="fas fa-arrow-up"></i> +{{ 5 + loop.index }}%
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Lead Source Analysis -->
        <div class="dashboard-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Lead Source Analysis</h5>
                <button class="btn btn-sm btn-outline-primary" onclick="expandReport('sources')">
                    <i class="fas fa-expand-alt me-1"></i>View Details
                </button>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Leads</th>
                            <th>Conversions</th>
                            <th>Conversion Rate</th>
                            <th>Cost per Lead</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for source, total, converted in conversion_by_source %}
                        {% set conversion_rate = (converted / total * 100) | round(1) if total > 0 else 0 %}
                        {% set cost_per_lead = [25, 15, 8, 35, 0] %}
                        {% set roi = ((converted * 1200 - total * cost_per_lead[loop.index0]) / (total * cost_per_lead[loop.index0]) * 100) | round(1) if total > 0 and cost_per_lead[loop.index0] > 0 else 0 %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-{{ 'globe' if source == 'Website' else 'share-alt' if source == 'Social Media' else 'bullhorn' if source == 'Google Ads' else 'users' if source == 'Referral' else 'walking' }} me-2 text-primary"></i>
                                    <strong>{{ source }}</strong>
                                </div>
                            </td>
                            <td>{{ total }}</td>
                            <td>{{ converted }}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">{{ conversion_rate }}%</span>
                                    <div class="progress-custom" style="width: 50px;">
                                        <div class="progress-bar-custom" style="width: {{ conversion_rate }}%"></div>
                                    </div>
                                </div>
                            </td>
                            <td>${{ cost_per_lead[loop.index0] }}</td>
                            <td>
                                <span class="{{ 'text-success' if roi > 0 else 'text-danger' if roi < 0 else 'text-muted' }}">
                                    {{ roi }}%
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Quick Insights -->
        <div class="dashboard-card mb-4">
            <h5 class="mb-3">Quick Insights</h5>
            
            <div class="insight-item mb-3">
                <div class="d-flex align-items-start">
                    <div class="insight-icon bg-success text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 40px; height: 40px;">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Best Performing Course</h6>
                        <p class="mb-1">{{ course_popularity[0][0] if course_popularity else 'N/A' }}</p>
                        <small class="text-muted">{{ course_popularity[0][1] if course_popularity else 0 }} enrollments this month</small>
                    </div>
                </div>
            </div>
            
            <div class="insight-item mb-3">
                <div class="d-flex align-items-start">
                    <div class="insight-icon bg-warning text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 40px; height: 40px;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Peak Lead Generation Day</h6>
                        <p class="mb-1">Tuesday</p>
                        <small class="text-muted">35% more leads than average</small>
                    </div>
                </div>
            </div>
            
            <div class="insight-item mb-3">
                <div class="d-flex align-items-start">
                    <div class="insight-icon bg-info text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 40px; height: 40px;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Average Response Time</h6>
                        <p class="mb-1">2.3 hours</p>
                        <small class="text-muted">18% improvement from last month</small>
                    </div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="d-flex align-items-start">
                    <div class="insight-icon bg-primary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 40px; height: 40px;">
                        <i class="fas fa-star"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Customer Satisfaction</h6>
                        <p class="mb-1">4.6/5</p>
                        <small class="text-muted">Based on 156 reviews</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Action Items -->
        <div class="dashboard-card mb-4">
            <h5 class="mb-3">Recommended Actions</h5>
            
            <div class="action-item mb-3">
                <div class="d-flex">
                    <div class="action-priority bg-danger text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 24px; height: 24px; font-size: 12px;">
                        !
                    </div>
                    <div>
                        <h6 class="mb-1">High Priority</h6>
                        <p class="mb-1 small">15 leads haven't been contacted in 7+ days</p>
                        <button class="btn btn-sm btn-outline-danger" onclick="viewOverdueLeads()">Take Action</button>
                    </div>
                </div>
            </div>
            
            <div class="action-item mb-3">
                <div class="d-flex">
                    <div class="action-priority bg-warning text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 24px; height: 24px; font-size: 12px;">
                        !
                    </div>
                    <div>
                        <h6 class="mb-1">Medium Priority</h6>
                        <p class="mb-1 small">Social Media conversion rate declining</p>
                        <button class="btn btn-sm btn-outline-warning" onclick="viewSocialMediaAnalysis()">Investigate</button>
                    </div>
                </div>
            </div>
            
            <div class="action-item">
                <div class="d-flex">
                    <div class="action-priority bg-success text-white rounded-circle me-3 d-flex align-items-center justify-content-center" 
                         style="width: 24px; height: 24px; font-size: 12px;">
                        ✓
                    </div>
                    <div>
                        <h6 class="mb-1">Opportunity</h6>
                        <p class="mb-1 small">Referral program showing strong ROI</p>
                        <button class="btn btn-sm btn-outline-success" onclick="expandReferralProgram()">Expand</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Export Options -->
        <div class="dashboard-card">
            <h5 class="mb-3">Export Reports</h5>
            
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" onclick="exportDetailedReport('sales')">
                    <i class="fas fa-file-pdf me-2"></i>Sales Report (PDF)
                </button>
                <button class="btn btn-outline-success" onclick="exportDetailedReport('courses')">
                    <i class="fas fa-file-excel me-2"></i>Course Analytics (Excel)
                </button>
                <button class="btn btn-outline-info" onclick="exportDetailedReport('leads')">
                    <i class="fas fa-file-csv me-2"></i>Lead Data (CSV)
                </button>
                <button class="btn btn-outline-warning" onclick="scheduleReport()">
                    <i class="fas fa-clock me-2"></i>Schedule Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Report Detail Modal -->
<div class="modal fade" id="reportDetailModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Detailed Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="reportDetailContent">
                <!-- Detailed report content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="exportCurrentReport()">Export</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Reports functionality
let currentDateRange = {
    from: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000), // 30 days ago
    to: new Date()
};

document.addEventListener('DOMContentLoaded', function() {
    initializeReportsCharts();
    updateReportsData();
});

function initializeReportsCharts() {
    // Initialize all charts with Chart.js
    if (typeof initializeReportsCharts === 'function') {
        initializeReportsCharts();
    }
    
    // Load charts from charts.js if available
    if (typeof Chart !== 'undefined') {
        setTimeout(() => {
            if (typeof initializeMonthlyLeadsChart === 'function') {
                initializeMonthlyLeadsChart();
            }
            if (typeof initializeSourcePerformanceChart === 'function') {
                initializeSourcePerformanceChart();
            }
            if (typeof initializeRevenueBreakdownChart === 'function') {
                initializeRevenueBreakdownChart();
            }
            initializeCoursePopularityChart();
        }, 500);
    }
}

function initializeCoursePopularityChart() {
    const ctx = document.getElementById('coursePopularityChart');
    if (!ctx) return;

    const courseData = {{ course_popularity | tojsonfilter }};
    const labels = courseData.map(item => item[0]);
    const data = courseData.map(item => item[1]);

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: [
                    '#3498db',
                    '#27ae60',
                    '#f39c12',
                    '#e74c3c',
                    '#9b59b6',
                    '#1abc9c'
                ],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                            return `${context.label}: ${context.parsed} enrollments (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}

function changeChartPeriod(period) {
    // Update chart based on selected period
    event.target.parentElement.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Reload chart data for the selected period
    updateChartData(period);
}

function updateChartData(period) {
    showLoading();
    
    // Simulate data loading
    setTimeout(() => {
        hideLoading();
        showNotification(`Chart updated for ${period}ly view`, 'success');
    }, 1000);
}

function setQuickRange(range) {
    const today = new Date();
    let fromDate = new Date();
    
    switch (range) {
        case 'week':
            fromDate.setDate(today.getDate() - 7);
            break;
        case 'month':
            fromDate.setMonth(today.getMonth() - 1);
            break;
        case 'quarter':
            fromDate.setMonth(today.getMonth() - 3);
            break;
    }
    
    document.getElementById('dateFrom').value = fromDate.toISOString().split('T')[0];
    document.getElementById('dateTo').value = today.toISOString().split('T')[0];
}

function applyDateFilter() {
    const fromDate = document.getElementById('dateFrom').value;
    const toDate = document.getElementById('dateTo').value;
    
    if (!fromDate || !toDate) {
        alert('Please select both from and to dates');
        return;
    }
    
    if (new Date(fromDate) > new Date(toDate)) {
        alert('From date cannot be later than to date');
        return;
    }
    
    currentDateRange = {
        from: new Date(fromDate),
        to: new Date(toDate)
    };
    
    updateReportsData();
    
    // Close dropdown
    const dropdown = bootstrap.Dropdown.getInstance(document.querySelector('[data-bs-toggle="dropdown"]'));
    if (dropdown) {
        dropdown.hide();
    }
    
    showNotification('Date filter applied successfully', 'success');
}

function updateReportsData() {
    showLoading();
    
    // Simulate data update
    setTimeout(() => {
        hideLoading();
        
        // Update charts
        initializeReportsCharts();
        
        // Update statistics
        updateStatistics();
    }, 1500);
}

function updateStatistics() {
    // Animate statistics updates
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
        const finalValue = stat.textContent.replace(/[^0-9]/g, '');
        if (finalValue) {
            animateNumber(stat, parseInt(finalValue));
        }
    });
}

function animateNumber(element, finalValue) {
    const startValue = 0;
    const duration = 1000;
    const increment = finalValue / (duration / 16);
    let currentValue = startValue;
    
    const timer = setInterval(() => {
        currentValue += increment;
        if (currentValue >= finalValue) {
            currentValue = finalValue;
            clearInterval(timer);
        }
        
        // Format number based on original content
        if (element.textContent.includes('$')) {
            element.textContent = '$' + Math.floor(currentValue).toLocaleString();
        } else if (element.textContent.includes('%')) {
            element.textContent = Math.floor(currentValue) + '%';
        } else {
            element.textContent = Math.floor(currentValue).toLocaleString();
        }
    }, 16);
}

function expandReport(reportType) {
    let title = '';
    let content = '';
    
    switch (reportType) {
        case 'sales':
            title = 'Detailed Sales Performance Report';
            content = generateSalesReportContent();
            break;
        case 'courses':
            title = 'Course Performance Analysis';
            content = generateCourseReportContent();
            break;
        case 'sources':
            title = 'Lead Source Analysis';
            content = generateSourceReportContent();
            break;
    }
    
    document.querySelector('#reportDetailModal .modal-title').textContent = title;
    document.getElementById('reportDetailContent').innerHTML = content;
    
    new bootstrap.Modal(document.getElementById('reportDetailModal')).show();
}

function generateSalesReportContent() {
    return `
        <div class="row">
            <div class="col-md-6">
                <h6>Sales Funnel Analysis</h6>
                <div class="funnel-chart" style="height: 300px;">
                    <canvas id="detailedSalesFunnel"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <h6>Revenue Trends</h6>
                <div class="trend-chart" style="height: 300px;">
                    <canvas id="revenueTrendChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h6>Sales Team Performance</h6>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Sales Rep</th>
                            <th>Leads Assigned</th>
                            <th>Conversions</th>
                            <th>Conversion Rate</th>
                            <th>Revenue Generated</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>John Smith</td>
                            <td>45</td>
                            <td>28</td>
                            <td>62%</td>
                            <td>$35,000</td>
                        </tr>
                        <tr>
                            <td>Sarah Johnson</td>
                            <td>38</td>
                            <td>25</td>
                            <td>66%</td>
                            <td>$31,250</td>
                        </tr>
                        <tr>
                            <td>Mike Davis</td>
                            <td>42</td>
                            <td>24</td>
                            <td>57%</td>
                            <td>$30,000</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function generateCourseReportContent() {
    return `
        <div class="row">
            <div class="col-md-12">
                <h6>Course Performance Metrics</h6>
                <div class="course-metrics-chart" style="height: 400px;">
                    <canvas id="detailedCourseMetrics"></canvas>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h6>Student Satisfaction by Course</h6>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Course</th>
                            <th>Students</th>
                            <th>Completion Rate</th>
                            <th>Avg. Rating</th>
                            <th>Reviews</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Web Development</td>
                            <td>45</td>
                            <td>89%</td>
                            <td>4.6/5</td>
                            <td>42</td>
                            <td>$54,000</td>
                        </tr>
                        <tr>
                            <td>Data Science</td>
                            <td>38</td>
                            <td>85%</td>
                            <td>4.4/5</td>
                            <td>35</td>
                            <td>$45,600</td>
                        </tr>
                        <tr>
                            <td>Digital Marketing</td>
                            <td>32</td>
                            <td>92%</td>
                            <td>4.7/5</td>
                            <td>30</td>
                            <td>$38,400</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function generateSourceReportContent() {
    return `
        <div class="row">
            <div class="col-md-8">
                <h6>Lead Source Performance Over Time</h6>
                <div class="source-trend-chart" style="height: 300px;">
                    <canvas id="sourcePerformanceTrend"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <h6>Cost Analysis</h6>
                <div class="cost-analysis">
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Total Marketing Spend</span>
                            <strong>$12,450</strong>
                        </div>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Cost per Lead</span>
                            <strong>$18.50</strong>
                        </div>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Cost per Conversion</span>
                            <strong>$95.40</strong>
                        </div>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Overall ROI</span>
                            <strong class="text-success">485%</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function exportReport(format) {
    showLoading();
    
    setTimeout(() => {
        hideLoading();
        showNotification(`Report exported as ${format.toUpperCase()}`, 'success');
    }, 2000);
}

function exportDetailedReport(type) {
    showLoading();
    
    setTimeout(() => {
        hideLoading();
        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} report exported successfully`, 'success');
    }, 1500);
}

function exportCurrentReport() {
    exportReport('pdf');
}

function scheduleReport() {
    // Open scheduling modal
    showNotification('Report scheduling feature coming soon!', 'info');
}

// Action item handlers
function viewOverdueLeads() {
    window.location.href = '/leads?filter=overdue';
}

function viewSocialMediaAnalysis() {
    expandReport('sources');
}

function expandReferralProgram() { 
       showNotification('Referral program expansion analysis coming soon!', 'info');
}
</script>
{% endblock %}
