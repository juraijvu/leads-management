{% extends "base.html" %}

{% block title %}Lead Details - {{ lead.name if lead else 'Not Found' }}{% endblock %}

{% block breadcrumb %}
{{ super() }}
<li class="breadcrumb-item"><a href="{{ url_for('main.leads') }}">Leads</a></li>
<li class="breadcrumb-item active">{{ lead.name if lead else 'Lead Details' }}</li>
{% endblock %}

{% block content %}
{% if not lead %}
<div class="container-fluid d-flex align-items-center justify-content-center" style="min-height: 60vh;">
    <div class="text-center">
        <i class="fas fa-exclamation-triangle fa-4x text-warning mb-3"></i>
        <h3 class="text-muted">Lead Not Found</h3>
        <p class="text-muted">The requested lead could not be found or has been deleted.</p>
        <a href="{{ url_for('main.leads') }}" class="btn btn-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Leads
        </a>
    </div>
</div>
{% else %}

<!-- Lead Header -->
<div class="glass-card p-4 mb-4">
    <div class="row align-items-center">
        <div class="col-md-6">
            <div class="d-flex align-items-center">
                <div class="avatar bg-{{ 'success' if lead.status == 'Converted' else 'primary' if lead.status == 'New' else 'warning' if lead.status == 'Contacted' else 'info' if lead.status == 'Interested' else 'secondary' if lead.status == 'Quoted' else 'danger' }} text-white rounded-circle me-4 d-flex align-items-center justify-content-center" 
                     style="width: 80px; height: 80px; font-size: 2rem;">
                    {{ lead.name[0].upper() }}
                </div>
                <div>
                    <h2 class="mb-1 fw-bold">{{ lead.name }}</h2>
                    <div class="lead-meta">
                        <span class="status-badge status-{{ lead.status.lower() }} me-3">
                            {{ lead.status }}
                        </span>
                        {% if lead.course_interest %}
                        <span class="badge bg-info me-3">{{ lead.course_interest.name }}</span>
                        {% endif %}
                        {% if lead.lead_source %}
                        <span class="badge bg-secondary">{{ lead.lead_source }}</span>
                        {% endif %}
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            Created {{ lead.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 text-end">
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary" onclick="editLead({{ lead.id }})">
                    <i class="fas fa-edit me-2"></i>Edit Lead
                </button>
                {% if lead.status != 'Converted' and lead.course_interest %}
                <button class="btn btn-success" onclick="convertLead({{ lead.id }})">
                    <i class="fas fa-user-graduate me-2"></i>Convert to Student
                </button>
                {% endif %}
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="duplicateLead({{ lead.id }})">
                            <i class="fas fa-copy me-2"></i>Duplicate Lead
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportLead({{ lead.id }})">
                            <i class="fas fa-download me-2"></i>Export Data
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="deleteLead({{ lead.id }})">
                            <i class="fas fa-trash me-2"></i>Delete Lead
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lead Content -->
<div class="row">
    <!-- Left Column -->
    <div class="col-lg-8">
        <!-- Contact Information -->
        <div class="glass-card p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-address-card text-primary me-2"></i>
                    Contact Information
                </h5>
                <button class="btn btn-sm btn-outline-primary" onclick="editContactInfo()">
                    <i class="fas fa-edit me-1"></i>Edit
                </button>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="contact-item mb-3">
                        <label class="form-label small text-muted">Phone Number</label>
                        <div class="contact-value">
                            <i class="fas fa-phone text-primary me-2"></i>
                            <span>{{ lead.phone }}</span>
                            <button class="btn btn-sm btn-link p-0 ms-2" onclick="makeCall('{{ lead.phone }}')" title="Call">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    {% if lead.email %}
                    <div class="contact-item mb-3">
                        <label class="form-label small text-muted">Email Address</label>
                        <div class="contact-value">
                            <i class="fas fa-envelope text-success me-2"></i>
                            <span>{{ lead.email }}</span>
                            <button class="btn btn-sm btn-link p-0 ms-2" onclick="sendEmail('{{ lead.email }}')" title="Send Email">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <div class="col-md-6">
                    {% if lead.whatsapp %}
                    <div class="contact-item mb-3">
                        <label class="form-label small text-muted">WhatsApp</label>
                        <div class="contact-value">
                            <i class="fab fa-whatsapp text-success me-2"></i>
                            <span>{{ lead.whatsapp }}</span>
                            <button class="btn btn-sm btn-link p-0 ms-2" onclick="openWhatsApp('{{ lead.whatsapp }}')" title="WhatsApp">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="contact-item mb-3">
                        <label class="form-label small text-muted">Preferred Contact Method</label>
                        <div class="contact-value">
                            <i class="fas fa-star text-warning me-2"></i>
                            <span>{{ lead.preferred_contact or 'Not specified' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Lead Details -->
        <div class="glass-card p-4 mb-4">
            <h5 class="mb-3">
                <i class="fas fa-info-circle text-info me-2"></i>
                Lead Details
            </h5>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="detail-item mb-3">
                        <label class="form-label small text-muted">Course Interest</label>
                        <div class="detail-value">
                            {% if lead.course_interest %}
                            <div class="d-flex align-items-center">
                                <span class="badge bg-info me-2">{{ lead.course_interest.name }}</span>
                                <small class="text-muted">${{ "{:,.0f}".format(lead.course_interest.price) }}</small>
                            </div>
                            {% else %}
                            <span class="text-muted">Not specified</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="detail-item mb-3">
                        <label class="form-label small text-muted">Lead Source</label>
                        <div class="detail-value">
                            {% if lead.lead_source %}
                            <span class="badge bg-secondary">{{ lead.lead_source }}</span>
                            {% else %}
                            <span class="text-muted">Unknown</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="detail-item mb-3">
                        <label class="form-label small text-muted">Quoted Amount</label>
                        <div class="detail-value">
                            {% if lead.quoted_amount and lead.quoted_amount > 0 %}
                            <span class="fw-bold text-success fs-5">${{ "{:,.2f}".format(lead.quoted_amount) }}</span>
                            {% else %}
                            <span class="text-muted">Not quoted yet</span>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="addQuote()">
                                <i class="fas fa-plus me-1"></i>Add Quote
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="detail-item mb-3">
                        <label class="form-label small text-muted">Lead Priority</label>
                        <div class="detail-value">
                            <select class="form-select form-select-sm" style="width: auto; display: inline-block;" onchange="updatePriority({{ lead.id }}, this.value)">
                                <option value="low" {{ 'selected' if lead.priority == 'low' else '' }}>ðŸŸ¢ Low</option>
                                <option value="medium" {{ 'selected' if lead.priority == 'medium' else '' }}>ðŸŸ¡ Medium</option>
                                <option value="high" {{ 'selected' if lead.priority == 'high' else '' }}>ðŸ”´ High</option>
                                <option value="urgent" {{ 'selected' if lead.priority == 'urgent' else '' }}>ðŸš¨ Urgent</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Follow-up Information -->
        <div class="glass-card p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-check text-warning me-2"></i>
                    Follow-up Information
                </h5>
                <button class="btn btn-sm btn-outline-warning" onclick="scheduleFollowup()">
                    <i class="fas fa-plus me-1"></i>Schedule Follow-up
                </button>
            </div>
            
            {% if lead.next_followup_date %}
            <div class="followup-info p-3 bg-light rounded">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock text-primary me-3 fa-lg"></i>
                            <div>
                                <div class="fw-bold">Next Follow-up: {{ lead.next_followup_date.strftime('%B %d, %Y') }}</div>
                                {% if lead.followup_type %}
                                <small class="text-muted">Type: {{ lead.followup_type }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        {% set days_until = (lead.next_followup_date - date.today()).days %}
                        {% if days_until < 0 %}
                        <span class="badge bg-danger">Overdue ({{ -days_until }} days)</span>
                        {% elif days_until == 0 %}
                        <span class="badge bg-warning">Due Today</span>
                        {% elif days_until <= 3 %}
                        <span class="badge bg-info">Due in {{ days_until }} day{{ 's' if days_until != 1 else '' }}</span>
                        {% else %}
                        <span class="badge bg-secondary">{{ days_until }} days away</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                <p class="text-muted">No follow-up scheduled</p>
                <button class="btn btn-warning" onclick="scheduleFollowup()">
                    <i class="fas fa-calendar-plus me-2"></i>Schedule First Follow-up
                </button>
            </div>
            {% endif %}
        </div>
        
        <!-- Comments and Notes -->
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-comments text-success me-2"></i>
                    Comments & Interactions
                </h5>
                <button class="btn btn-sm btn-outline-success" onclick="addComment()">
                    <i class="fas fa-plus me-1"></i>Add Comment
                </button>
            </div>
            
            {% if lead.comments %}
            <div class="comments-section">
                <div class="comment-item p-3 bg-light rounded mb-3">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; font-size: 12px;">
                                {{ lead.created_by.username[0].upper() if lead.created_by else 'S' }}
                            </div>
                            <div>
                                <small class="fw-bold">{{ lead.created_by.username if lead.created_by else 'System' }}</small>
                                <small class="text-muted d-block">{{ lead.created_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
                            </div>
                        </div>
                        <div class="comment-actions">
                            <button class="btn btn-sm btn-link text-muted" onclick="editComment()">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                    <div class="comment-content">
                        {{ lead.comments }}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Interaction History -->
            {% if lead.interactions %}
            <div class="interaction-history mt-4">
                <h6 class="text-muted mb-3">Interaction History</h6>
                {% for interaction in lead.interactions %}
                <div class="interaction-item d-flex align-items-start mb-3">
                    <div class="interaction-icon bg-{{ 'primary' if interaction.interaction_type == 'Call' else 'success' if interaction.interaction_type == 'Email' else 'info' if interaction.interaction_type == 'WhatsApp' else 'warning' }} text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; font-size: 12px;">
                        <i class="fas fa-{{ 'phone' if interaction.interaction_type == 'Call' else 'envelope' if interaction.interaction_type == 'Email' else 'whatsapp' if interaction.interaction_type == 'WhatsApp' else 'calendar' }}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <span class="fw-bold">{{ interaction.interaction_type }}</span>
                                <small class="text-muted ms-2">{{ interaction.interaction_date.strftime('%b %d, %Y at %I:%M %p') }}</small>
                            </div>
                            {% if interaction.is_important %}
                            <span class="badge bg-warning">Important</span>
                            {% endif %}
                        </div>
                        {% if interaction.content %}
                        <p class="mb-0 mt-1">{{ interaction.content }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                <p class="text-muted">No interactions recorded yet</p>
                <button class="btn btn-success" onclick="addComment()">
                    <i class="fas fa-plus me-2"></i>Add First Interaction
                </button>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Right Column -->
    <div class="col-lg-4">
        <!-- Lead Progress -->
        <div class="glass-card p-4 mb-4">
            <h6 class="mb-3">
                <i class="fas fa-chart-line text-primary me-2"></i>
                Lead Progress
            </h6>
            
            <div class="progress-pipeline mb-4">
                {% set progress_steps = ['New', 'Contacted', 'Interested', 'Quoted', 'Converted'] %}
                {% set current_index = progress_steps.index(lead.status) if lead.status in progress_steps else 0 %}
                
                {% for step in progress_steps %}
                {% set step_index = loop.index0 %}
                {% set is_active = step_index <= current_index %}
                {% set is_current = step == lead.status %}
                
                <div class="progress-step {{ 'active' if is_active else '' }} {{ 'current' if is_current else '' }}">
                    <div class="step-indicator">
                        {% if is_active %}
                        <i class="fas fa-check"></i>
                        {% else %}
                        <span>{{ loop.index }}</span>
                        {% endif %}
                    </div>
                    <div class="step-label">{{ step }}</div>
                    {% if not loop.last %}
                    <div class="step-line {{ 'active' if step_index < current_index else '' }}"></div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <div class="progress-stats">
                <div class="stat-item mb-2">
                    <small class="text-muted">Progress</small>
                    <div class="progress-custom">
                        <div class="progress-bar-custom" style="width: {{ (current_index + 1) / progress_steps|length * 100 }}%"></div>
                    </div>
                    <small class="text-muted">{{ ((current_index + 1) / progress_steps|length * 100) | round | int }}% Complete</small>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="glass-card p-4 mb-4">
            <h6 class="mb-3">
                <i class="fas fa-bolt text-warning me-2"></i>
                Quick Actions
            </h6>
            
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" onclick="makeCall('{{ lead.phone }}')">
                    <i class="fas fa-phone me-2"></i>Call Lead
                </button>
                {% if lead.email %}
                <button class="btn btn-outline-success" onclick="sendEmail('{{ lead.email }}')">
                    <i class="fas fa-envelope me-2"></i>Send Email
                </button>
                {% endif %}
                {% if lead.whatsapp %}
                <button class="btn btn-outline-info" onclick="openWhatsApp('{{ lead.whatsapp }}')">
                    <i class="fab fa-whatsapp me-2"></i>WhatsApp
                </button>
                {% endif %}
                <button class="btn btn-outline-warning" onclick="scheduleMeeting()">
                    <i class="fas fa-calendar me-2"></i>Schedule Meeting
                </button>
                {% if lead.status != 'Converted' %}
                <button class="btn btn-outline-secondary" onclick="updateStatus()">
                    <i class="fas fa-edit me-2"></i>Update Status
                </button>
                {% endif %}
            </div>
        </div>
        
        <!-- Lead Statistics -->
        <div class="glass-card p-4 mb-4">
            <h6 class="mb-3">
                <i class="fas fa-chart-bar text-info me-2"></i>
                Lead Statistics
            </h6>
            
            <div class="stat-item mb-3">
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Days in Pipeline</span>
                    <span class="fw-bold">{{ (date.today() - lead.created_at.date()).days }}</span>
                </div>
            </div>
            
            <div class="stat-item mb-3">
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Last Contact</span>
                    <span class="fw-bold">
                        {% if lead.last_contact_date %}
                        {{ (date.today() - lead.last_contact_date).days }} days ago
                        {% else %}
                        Never
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <div class="stat-item mb-3">
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Interactions</span>
                    <span class="fw-bold">{{ lead.interactions.count() if lead.interactions else 0 }}</span>
                </div>
            </div>
            
            <div class="stat-item">
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Conversion Probability</span>
                    <span class="fw-bold text-{{ 'success' if lead.status == 'Interested' or lead.status == 'Quoted' else 'warning' if lead.status == 'Contacted' else 'info' }}">
                        {{ {'New': '20%', 'Contacted': '35%', 'Interested': '65%', 'Quoted': '80%', 'Converted': '100%', 'Lost': '0%'}[lead.status] }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Related Information -->
        <div class="glass-card p-4">
            <h6 class="mb-3">
                <i class="fas fa-link text-secondary me-2"></i>
                Related Information
            </h6>
            
            {% if lead.course_interest %}
            <div class="related-item mb-3">
                <div class="d-flex align-items-center">
                    <i class="fas fa-book text-info me-3"></i>
                    <div>
                        <div class="fw-bold">{{ lead.course_interest.name }}</div>
                        <small class="text-muted">Price: ${{ "{:,.0f}".format(lead.course_interest.price) }}</small>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if lead.created_by %}
            <div class="related-item mb-3">
                <div class="d-flex align-items-center">
                    <i class="fas fa-user text-primary me-3"></i>
                    <div>
                        <div class="fw-bold">Assigned to {{ lead.created_by.username }}</div>
                        <small class="text-muted">Lead Owner</small>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="related-item">
                <div class="d-flex align-items-center">
                    <i class="fas fa-clock text-warning me-3"></i>
                    <div>
                        <div class="fw-bold">Last Updated</div>
                        <small class="text-muted">{{ lead.created_at.strftime('%b %d, %Y at %I:%M %p') }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.contact-item, .detail-item {
    position: relative;
}

.contact-value, .detail-value {
    display: flex;
    align-items: center;
    padding: 8px 0;
}

.progress-pipeline {
    position: relative;
}

.progress-step {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    position: relative;
}

.step-indicator {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    margin-right: 15px;
    z-index: 2;
    position: relative;
}

.progress-step.active .step-indicator {
    background: var(--uiverse-primary);
    color: white;
}

.progress-step.current .step-indicator {
    background: var(--uiverse-success);
    color: white;
    animation: pulse 2s infinite;
}

.step-label {
    font-weight: 500;
    color: #6c757d;
}

.progress-step.active .step-label {
    color: var(--uiverse-primary);
    font-weight: 600;
}

.progress-step.current .step-label {
    color: var(--uiverse-success);
    font-weight: 700;
}

.step-line {
    position: absolute;
    left: 14px;
    top: 30px;
    width: 2px;
    height: 20px;
    background: #e9ecef;
}

.step-line.active {
    background: var(--uiverse-primary);
}

.followup-info {
    border-left: 4px solid var(--uiverse-warning);
}

.comment-item {
    border-left: 4px solid var(--uiverse-info);
}

.interaction-history {
    border-top: 1px solid #e9ecef;
    padding-top: 20px;
}

.related-item {
    padding: 10px 0;
    border-bottom: 1px solid #f8f9fa;
}

.related-item:last-child {
    border-bottom: none;
}

.stat-item {
    padding: 8px 0;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
    }
}
</style>

<script>
function editLead(leadId) {
    window.location.href = `/leads/${leadId}/edit`;
}

function convertLead(leadId) {
    if (confirm('Convert this lead to a student? This action cannot be undone.')) {
        showLoading();
        
        // Simulate API call
        setTimeout(() => {
            hideLoading();
            showNotification('Lead converted to student successfully!', 'success');
            
            // Update status badge
            const statusBadge = document.querySelector('.status-badge');
            if (statusBadge) {
                statusBadge.className = 'status-badge status-converted';
                statusBadge.textContent = 'Converted';
            }
            
            // Hide convert button
            const convertBtn = document.querySelector('[onclick^="convertLead"]');
            if (convertBtn) {
                convertBtn.style.display = 'none';
            }
        }, 1500);
    }
}

function duplicateLead(leadId) {
    if (confirm('Create a duplicate of this lead?')) {
        showLoading();
        setTimeout(() => {
            hideLoading();
            showNotification('Lead duplicated successfully!', 'success');
        }, 1000);
    }
}

function deleteLead(leadId) {
    if (confirm('Are you sure you want to delete this lead? This action cannot be undone.')) {
        showLoading();
        setTimeout(() => {
            hideLoading();
            showNotification('Lead deleted successfully!', 'success');
            window.location.href = '/leads';
        }, 1000);
    }
}

function exportLead(leadId) {
    showLoading();
    setTimeout(() => {
        hideLoading();
        showNotification('Lead data exported successfully!', 'success');
    }, 1000);
}

function editContactInfo() {
    showNotification('Contact editing feature coming soon!', 'info');
}

function addQuote() {
    const amount = prompt('Enter quote amount:');
    if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
        showLoading();
        setTimeout(() => {
            hideLoading();
            showNotification(`Quote of $${parseFloat(amount).toLocaleString()} added successfully!`, 'success');
            
            // Update quote display
            const quoteDiv = document.querySelector('.detail-value:has(.text-muted)');
            if (quoteDiv) {
                quoteDiv.innerHTML = `<span class="fw-bold text-success fs-5">$${parseFloat(amount).toLocaleString()}</span>`;
            }
        }, 500);
    }
}

function updatePriority(leadId, priority) {
    showLoading();
    setTimeout(() => {
        hideLoading();
        showNotification(`Lead priority updated to ${priority}`, 'success');
    }, 500);
}

function scheduleFollowup() {
    showNotification('Follow-up scheduling feature coming soon!', 'info');
}

function addComment() {
    const comment = prompt('Enter your comment:');
    if (comment && comment.trim()) {
        showLoading();
        setTimeout(() => {
            hideLoading();
            showNotification('Comment added successfully!', 'success');
            
            // Add comment to the page
            const commentsSection = document.querySelector('.comments-section') || 
                                  document.querySelector('.glass-card:has(.fa-comments) .glass-card');
            
            if (commentsSection) {
                const newComment = document.createElement('div');
                newComment.className = 'comment-item p-3 bg-light rounded mb-3';
                newComment.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; font-size: 12px;">
                                U
                            </div>
                            <div>
                                <small class="fw-bold">Current User</small>
                                <small class="text-muted d-block">${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: '2-digit' })}</small>
                            </div>
                        </div>
                    </div>
                    <div class="comment-content">
                        ${comment}
                    </div>
                `;
                commentsSection.insertBefore(newComment, commentsSection.firstChild);
            }
        }, 500);
    }
}

function editComment() {
    showNotification('Comment editing feature coming soon!', 'info');
}

function makeCall(phone) {
    if (confirm(`Call ${phone}?`)) {
        window.open(`tel:${phone}`);
        
        // Log interaction
        setTimeout(() => {
            showNotification('Call interaction logged', 'info');
        }, 1000);
    }
}

function sendEmail(email) {
    const subject = encodeURIComponent('Training Course Follow-up');
    const body = encodeURIComponent('Hi,\n\nThank you for your interest in our training courses. I would like to discuss how we can help you achieve your learning goals.\n\nBest regards,\nTraining Center Team');
    window.open(`mailto:${email}?subject=${subject}&body=${body}`);
    
    // Log interaction
    setTimeout(() => {
        showNotification('Email interaction logged', 'info');
    }, 1000);
}

function openWhatsApp(phone) {
    const message = encodeURIComponent('Hi! I am reaching out regarding your interest in our training courses.');
    window.open(`https://wa.me/${phone.replace(/\D/g, '')}?text=${message}`, '_blank');
    
    // Log interaction
    setTimeout(() => {
        showNotification('WhatsApp interaction logged', 'info');
    }, 1000);
}

function scheduleMeeting() {
    window.location.href = `/meetings/add?lead_id={{ lead.id }}`;
}

function updateStatus() {
    showNotification('Status update feature coming soon!', 'info');
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress steps
    const steps = document.querySelectorAll('.progress-step');
    steps.forEach((step, index) => {
        step.style.opacity = '0';
        step.style.transform = 'translateX(-20px)';
        
        setTimeout(() => {
            step.style.transition = 'all 0.5s ease';
            step.style.opacity = '1';
            step.style.transform = 'translateX(0)';
        }, index * 100);
    });
    
    // Animate stats
    const statNumbers = document.querySelectorAll('.stat-item .fw-bold');
    statNumbers.forEach((stat, index) => {
        if (!isNaN(stat.textContent)) {
            stat.style.opacity = '0';
            setTimeout(() => {
                stat.style.transition = 'opacity 0.5s ease';
                stat.style.opacity = '1';
            }, index * 200);
        }
    });
});
</script>

{% endif %}
{% endblock %}
